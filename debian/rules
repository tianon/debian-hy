#!/usr/bin/make -f

export PYBUILD_NAME=hy

BUILD_DATE=$(shell dpkg-parsechangelog -S Date | LC_ALL=C date -u '+%B %d, %Y' -f -)

%:
	dh $@ --with python2,python3 --buildsystem pybuild

override_dh_auto_build:
	dh_auto_build
	# have to set HOME because rply wants to write into ~/.cache/rply
	make -C docs \
		SPHINXOPTS='-D today="$(BUILD_DATE)"' \
		HOME='$(CURDIR)/docs/fake-home' \
		man
	# TODO html docs (and install them in hy-doc or something)

override_dh_auto_install:
	dh_auto_install
	for bin in debian/python-hy/usr/bin/*; do \
		mv -v $$bin $${bin}2; \
	done
	for bin in debian/python3-hy/usr/bin/*; do \
		mv -v $$bin $${bin}3; \
	done

override_dh_installchangelogs:
	dh_installchangelogs NEWS
